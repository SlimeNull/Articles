<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>[Win32] MCI 详解与封装类, MCI 播放音乐, 获取播放状态, 获取音频长度, 进度调整 - 诺尔的小窝</title><meta name=keywords content="史莱姆诺尔,萌诺尔,诺尔,博客,程序员,自学,编程,笔记,技术,分享,.NET,C#"><meta name=author content="史莱姆诺尔"><meta property="og:title" content="[Win32] MCI 详解与封装类, MCI 播放音乐, 获取播放状态, 获取音频长度, 进度调整"><meta property="og:site_name" content="诺尔的小窝"><meta property="og:image" content="https://slimenull.topimg/author.jpg"><meta name=title content="[Win32] MCI 详解与封装类, MCI 播放音乐, 获取播放状态, 获取音频长度, 进度调整 - 诺尔的小窝"><meta name=description content="为了更好的开源世界~"><link rel="shortcut icon" href=https://slimenull.topimg/favicon.ico><link rel=apple-touch-icon href=https://slimenull.topimg/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=https://slimenull.topimg/apple-touch-icon.png><link href=//unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//unpkg.com/imageviewer@1.1.0/dist/viewer.min.css rel=stylesheet><link href=https://slimenull.topcss/main.css rel=stylesheet type=text/css><link href=https://slimenull.topcss/syntax.css rel=stylesheet type=text/css></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>诺尔的小窝</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>前进! 前进! 不择手段的前进!</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-active"><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class=menu-item><a href=/404.html rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://slimenull.top/post/win32-mci/ itemprop=url>[Win32] MCI 详解与封装类, MCI 播放音乐, 获取播放状态, 获取音频长度, 进度调整</a></h1><div class=post-meta><span class=post-pushdate><i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2021-02-11">2021-02-11</time></span>
<span class=post-wordcount><i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>3354 字</span></span>
<span class=post-readtime><i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>7分钟</span></span>
<span id=/post/win32-mci/ class="leancloud_visitors post-visitor" data-flag-title="[Win32] MCI 详解与封装类, MCI 播放音乐, 获取播放状态, 获取音频长度, 进度调整"><i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><p>MCI 打开文件, 播放, 暂停, 停止音频, 设定播放进度, 获取播放进度</p><h2 id=淦>淦!</h2><p>琢磨了一晚上啊, 总算有些眉目了.</p><p>首先, MCI的全称是Multimedia Control Interface, 即多媒体控制接口, 通过它, 我们可以做到播放音频视频, 甚至录制音频, 虽然古老, 但是真的强大.</p><p>注意, 文章较官方文档有不少删减, 如果看标准内容, 还是看官方文档比较好.</p><blockquote><p>MCI Command Strings 官方文档: <a href=https://docs.microsoft.com/en-us/windows/win32/multimedia/mci-command-strings target=_blank rel=noopener>Microsoft Command Strings - Win32 app | Microsoft Docs</a>
哦对了, 文档是纯英文哦~</p></blockquote><h2 id=理论基础>理论基础:</h2><ol><li>MCI 不能与 C# 中的内存流打交道, 他只能播放文件.</li><li>MCI 支持很多格式, 包含: CD音频, 数字音频, MIDI音乐, 视频唱片(videodisc), VCR, 以及波形音频.</li><li>MCI 中, 被播放的音频文件被称作 <strong>设备(Device)</strong></li><li>MCI 中, 支持巨多设置项, 包括播放进度, 音量大小, 声道开关, 如果你播放的是 MIDI, 支持的设置更多.</li></ol><h2 id=正式开始>正式开始:</h2><p>下面, 我们将以播放音频为例, 尽可能多的讲述 MCI 的相关知识, 文章在今后可能会继续更新.</p><p>示例文件在: C:\Users\Null\Desktop\Tutorial.wav</p><h4 id=-引用库>> 引用库:</h4><ul><li>最最开始, 无非是载入库.</li></ul><ol><li>对于 C++, 需要引用 Windows.h 以及 Mmsystem.h 这两个头文件</li><li>对于 C#, using System.Runtime.InteropServices; 以进行非托管库的调用.</li></ol><h4 id=-执行指令>> 执行指令:</h4><ul><li>MCI 中, 有 3 种方式来执行 MCI 指令. 分别是: mciSendString, mciExecute, mciSendCommand, 它们均位于 winmm.dll 中.</li></ul><h1 id=heading></h1><ul><li><p><strong>函数原型:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>MCIERROR <span style=color:#00a000>mciSendString</span>(    <span style=color:#080;font-style:italic>// MCIERROR 是 无符号长整形数字
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>    LPCTSTR lpszCommand,
</span></span><span style=display:flex><span>    LPTSTR  lpszReturnString,
</span></span><span style=display:flex><span>    UINT    cchReturn,
</span></span><span style=display:flex><span>    HANDLE  hwndCallback
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BOOL <span style=color:#00a000>mciExecute</span>(
</span></span><span style=display:flex><span>    LPCSTR pszCommand
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  MCIERROR <span style=color:#00a000>mciSendCommand</span>(
</span></span><span style=display:flex><span>      MCIDEVICEID IDDevice,    <span style=color:#080;font-style:italic>// 设备 ID, 通过另一个函数打开文件可以获得
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>      UINT        uMsg,
</span></span><span style=display:flex><span>      DWORD_PTR   fdwCommand,
</span></span><span style=display:flex><span>      DWORD_PTR   dwParam
</span></span><span style=display:flex><span>  );
</span></span></code></pre></div></li><li><p><strong>C# 声明方式:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#b44>[DllImport(&#34;winmm.dll&#34;, EntryPoint = &#34;mciSendString&#34;, CharSet = CharSet.Unicode)]</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>extern</span> <span style=color:#a2f;font-weight:700>static</span> <span style=color:#0b0;font-weight:700>ulong</span> MciSendString(<span style=color:#0b0;font-weight:700>string</span> command, <span style=color:#0b0;font-weight:700>string</span> buffer, <span style=color:#0b0;font-weight:700>int</span> bufferSize, IntPtr callback);
</span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>[DllImport(&#34;winmm.dll&#34;, EntryPoint = &#34;mciExecute&#34;, CharSet = CharSet.Unicode)]</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>extern</span> <span style=color:#a2f;font-weight:700>static</span> <span style=color:#0b0;font-weight:700>bool</span> MciExecute(<span style=color:#0b0;font-weight:700>string</span> command);
</span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>[DllImport(&#34;winmm.dll&#34;, EntryPoint = &#34;mciSendCommand&#34;, CharSet = CharSet.Unicode)]</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>extern</span> <span style=color:#a2f;font-weight:700>static</span> <span style=color:#0b0;font-weight:700>ulong</span> MciSendCommand(<span style=color:#0b0;font-weight:700>uint</span> deviceId, <span style=color:#0b0;font-weight:700>uint</span> uMsg, IntPtr fdwCommand, IntPtr dwParam);
</span></span></code></pre></div></li><li><p><strong>简略说明:</strong></p><blockquote><p>mciSendString: 最常用的方法, 通过字符串来表示一个指令, 会返回错误码, 不会有弹窗警告
mciExecute: 调试时较常用的方法, 在执行时若有未完善的地方, 会弹窗警告, 也因为如此, 程序的发布版本不会使用这个(影响使用体验)
mciSendCommand: 很少用, 通过指令的ID来表示指令, 会返回错误码, 不会有弹窗警告
 
某些 MCI 指令具有返回值, 例如获取播放状态, 这些指令不能通过mciExecute执行.</p></blockquote></li></ul><h1 id=heading-1></h1><ul><li>文章只会通过 mciSendString 来介绍 MCI 哟</li></ul><h4 id=-打开文件>> 打开文件:</h4><ul><li>对于播放音频, 首要的第一件事, 肯定就是打开文件并将其载入到内存了. 不过有一点很重要, 就是 MCI 指令只支持短路径(ShortPath), 所以在拿到文件路径后, 我们得将其转换为短路径.</li><li>如果不对路径进行转换, 那么某些名字长度大于8的文件(准确来说是路径中任何一部分长度大于8)的将无法播放<blockquote><p>关于短路径与长路径: <a href=https://blog.csdn.net/zfs2008zfs/article/details/51154873 target=_blank rel=noopener>windows系统下的文件长名和文件短名</a>
短路径与长路径的转换: <a href=https://blog.csdn.net/m0_46555380/article/details/113765617 target=_blank rel=noopener>[C#/C/C++] GetShortPathName 详解, 长路径转换为短路径</a></p></blockquote></li><li>MCI 指令中, 通过 open 来打开一个文件, 并且在末尾还可以使用 &ldquo;alias 别名&rdquo; 来为这个已打开的文件起一个别名.</li><li>下面是两个示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#080;font-style:italic>// 文件是 C:\Users\Null\Desktop\Tutorial.wav</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>// 转换为短路径是 C:\Users\Null\Desktop\Tut~1.wav</span>
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;open C:\Users\Null\Desktop\Tut~1.wav&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;open C:\Users\Null\Desktop\Tut~1.wav alias tutorial&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>在第一的 mciSendString 中, 很清晰明了, 打开了一个文件, 而第二个中, 我们还加了一个alias, 即, 别名, MCI支持为打开的文件起一个别名, 并且推荐这么做.
第二个种, 我们为它起的别名是 tutorial.</li></ul><h4 id=-播放音频>> 播放音频:</h4><ul><li>播放音频的 MCI 指令是 play, 直接 &ldquo;play 设备&rdquo;</li><li>示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;play C:\Users\Null\Desktop\Tut~1.wav&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;play tutorial&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>如果你没有为文件指定别名, 那么在使用 play 指令时, 只能指定短路径
如果你为文件指定了别名, 直接play加上别名即可播放这个文件.</li></ul><h4 id=-重复播放音频>> 重复播放音频:</h4><ul><li>这里, 用到了参数, 就像alias一样, 可选. 重复播放还是使用的play指令.</li><li>示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;play C:\Users\Null\Desktop\Tut~1.wav repeat&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;play tutorial repeat&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>设备名如旧, 可以直接指定短路径, 也可以指定别名, 而想做到重复播放, 只需要在最后指定repeat</li></ul><h4 id=-同步播放音频>> 同步播放音频:</h4><ul><li>同样是参数, 这里是wait, 支持wait参数的指令可以同步执行, 例如play指令</li><li>示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;play C:\Users\Null\Desktop\Tut~1.wav wait&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;play tutorial wait&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>执行后, 将会阻塞当前现成, 直至播放结束.</li></ul><h4 id=-暂停播放>> 暂停播放:</h4><ul><li>暂停, pause, 用法很简单, 同样是 &ldquo;pause 设备&rdquo;</li><li>示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;pause C:\Users\Null\Desktop\Tut~1.wav&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;pause tutorial&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>执行后, 正在播放的音频就会暂停.</li></ul><h4 id=-恢复播放>> 恢复播放:</h4><ul><li>恢复, resume, 语法是 &ldquo;resume 设备&rdquo;</li><li>示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;pause C:\Users\Null\Desktop\Tut~1.wav&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;pause tutorial&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>执行后, 暂停播放的音频就会恢复.</li></ul><h4 id=-关闭文件>> 关闭文件:</h4><ul><li>关闭, close, 语法是: &ldquo;close 设备&rdquo;</li><li>示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;close C:\Users\Null\Desktop\Tut~1.wav&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;close tutorial&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>执行后, 文件会被关闭. 如果音频正在播放, 则会停止.</li></ul><h4 id=-改变播放位置>> 改变播放位置:</h4><ul><li>seek 指令, 这个指令比较复杂哦. 语法如下:<blockquote><p>seek <em>device</em> to <em>position</em>
seek <em>device</em> to start
seek <em>device</em> to end</p></blockquote></li><li>示例:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;seek tutorial to 1000&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;seek tutorial to start&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>@&#34;seek tutorial to end&#34;</span>, <span style=color:#a2f;font-weight:700>null</span>, <span style=color:#666>0</span>, IntPtr.Zero);
</span></span></code></pre></div>短路径肯定是能用的哦, 我只是懒得写了, 至于 &ldquo;seek <em>device</em> to <em>position</em>&rdquo; 的用法, 其中position默认是ms为单位的整数时间哦, 也就是说, 1000代表1s.</li><li>seek 的单位是可以调整的, 继续看哦</li></ul><h4 id=-设置相关>> 设置相关:</h4><ul><li><p>设置, set, 这个支持的就更多了</p><blockquote><p><strong>以下是适用于 CD Audio 的语法 :</strong>
set <em>device</em> time format milliseconds
set <em>device</em> time format msf
set <em>device</em> time format tmsf</p></blockquote><blockquote><p><strong>以下是适用于 Wave Audio 的语法 :</strong>
set <em>device</em> any input
set <em>device</em> any output
set <em>device</em> channels <em>channel_count</em>
set <em>device</em> format tag pcm
set <em>device</em> format tag tag
set <em>device</em> input <em>integer</em>
set <em>device</em> output <em>integer</em>
set <em>device</em> time format bytes
set <em>device</em> time format milliseconds</p></blockquote><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td>time format milliseconds</td><td>将时间格式设置为毫秒, 所有使用position值的指令都将采用毫秒作为单位, 你可以将milliseconds缩写为ms. 对于音序器设备,</td></tr><tr><td>time format msf</td><td>设置时间格式到 分钟, 妙, 以及帧. 所有使用position值的指令都见采用MSF格式(CD音频的默认格式), 请将MSF值指定为 mm:ss:ff 的格式, mm是分钟, ss是秒, ff是帧. 如果一个字段以及后面的字段都是0, 你可以忽略掉它. 例如, 3, 3:0, 3:0:0 都是表示3分钟的正确方式. MSF字段有以下最大值, 分钟:99, 秒:59, 帧: 74.</td></tr><tr><td>time format tmsf</td><td>将时间格式设置为 音轨, 分钟, 秒, 以及帧. 所有使用position值的指令都见采用TMSF格式, 额, 与上面的一样, 只不过多了个音轨. 音轨的最大值是99, 分钟, 秒, 帧的最大值与MSF格式一致.</td></tr><tr><td>any input</td><td>当录制时, 使用所有支持当前格式的输入, 这是默认设置</td></tr><tr><td>any output</td><td>当播放时, 使用所有支持当前格式的输出, 这是默认的</td></tr><tr><td>time format bytes</td><td>在 PCM 文件格式中, 设置时间格式(单位)为字节, 指定这个指令后, 所有position信息都将被指定为字节格式</td></tr></tbody></table></li></ul><h4 id=-状态信息>> 状态信息:</h4><ul><li><p>状态, status, 语法: &ldquo;status <em>device</em> <em>option</em>&rdquo;, 返回到 mciSendString 参数指定的字符串缓冲区</p><blockquote><p><strong>适用于音频的常用语法</strong></p><p>status <em>device</em> position</p><p>status <em>device</em> length</p><p>status <em>device</em> mode</p><p>status <em>device</em> time format</p></blockquote><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td>position</td><td>获取目前播放的位置单位与时间格式统一</td></tr><tr><td>length</td><td>获取当前播放音频的长度 单位与时间格式统一</td></tr><tr><td>mode</td><td>获取播放状态, 返回的值是以下值之一: stopped / playing / paused</td></tr><tr><td>time format</td><td>获取当前的时间格式</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#0b0;font-weight:700>string</span> buffer = <span style=color:#a2f;font-weight:700>new</span> <span style=color:#0b0;font-weight:700>string</span>(<span style=color:#b44>&#39;\0&#39;</span>, <span style=color:#666>256</span>);       <span style=color:#080;font-style:italic>// 分配一个长度的字符串用来存放返回值</span>
</span></span><span style=display:flex><span>mciSendString(<span style=color:#b44>&#34;status tutorial position&#34;</span>, buffer, <span style=color:#666>256</span>, IntPtr.Zero);   <span style=color:#080;font-style:italic>// 调用</span>
</span></span><span style=display:flex><span>Console.WriteLine(buffer.TrimEnd(<span style=color:#b44>&#39;\0&#39;</span>));     <span style=color:#080;font-style:italic>// 打印返回值, TrimEnd的原因字符串的是长度是256, 函数没有使用的部分仍然是 \0 字符.</span>
</span></span></code></pre></div></li></ul><h4 id=-音频设置>> 音频设置</h4><ul><li><p>设置音频, setaudio, 语法 &ldquo;setaudio <em>device</em> <em>option</em>&rdquo;</p><blockquote><p><strong>常用语法:</strong></p><p>setaudio <em>device</em> left volume to <em>factor</em></p><p>setaudio <em>device</em> right volume to <em>factor</em></p><p>setaudio <em>device</em> volume to <em>factor</em></p></blockquote><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td>left/right volume to <em>factor</em></td><td>将指定声道的音量设置为指定值</td></tr><tr><td>volume to <em>factor</em></td><td>将音量设置为指定值</td></tr></tbody></table></li></ul><h2 id=错误码>错误码:</h2><ul><li>下面是sendMciString会返回的错误码以及描述(对名称翻译, 然后稍加校正), 哦对了, 返回 0 代表无错误哦<table><thead><tr><th>错误码</th><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>257</td><td>MCIERR_INVALID_DEVICE_ID</td><td>无效设备 ID</td></tr><tr><td>259</td><td>MCIERR_UNRECOGNIZED_KEYWORD</td><td>未识别关键字</td></tr><tr><td>261</td><td>MCIERR_UNRECOGNIZED_COMMAND</td><td>未识别的命令</td></tr><tr><td>262</td><td>MCIERR_HARDWARE</td><td>硬件</td></tr><tr><td>263</td><td>MCIERR_INVALID_DEVICE_NAME</td><td>无效的设备名称</td></tr><tr><td>264</td><td>MCIERR_OUT_OF_MEMORY</td><td>内存不足</td></tr><tr><td>265</td><td>MCIERR_DEVICE_OPEN</td><td>设备打开</td></tr><tr><td>266</td><td>MCIERR_CANNOT_LOAD_DRIVER</td><td>无法加载驱动程序</td></tr><tr><td>267</td><td>MCIERR_MISSING_COMMAND_STRING</td><td>缺少命令字符串</td></tr><tr><td>268</td><td>MCIERR_PARAM_OVERFLOW</td><td>参数溢出</td></tr><tr><td>269</td><td>MCIERR_MISSING_STRING_ARGUMENT</td><td>缺少字符串参数</td></tr><tr><td>270</td><td>MCIERR_BAD_INTEGER</td><td>坏整数</td></tr><tr><td>271</td><td>MCIERR_PARSER_INTERNAL</td><td>分析器内部 (估计是这个API内部对指令分析时出现的错误)</td></tr><tr><td>272</td><td>MCIERR_DRIVER_INTERNAL</td><td>驱动程序内部</td></tr><tr><td>273</td><td>MCIERR_MISSING_PARAMETER</td><td>缺少参数</td></tr><tr><td>274</td><td>MCIERR_UNSUPPORTED_FUNCTION</td><td>不支持的功能</td></tr><tr><td>275</td><td>MCIERR_FILE_NOT_FOUND</td><td>未找到文件</td></tr><tr><td>276</td><td>MCIERR_DEVICE_NOT_READY</td><td>设备未就绪</td></tr><tr><td>277</td><td>MCIERR_INTERNAL</td><td>内部</td></tr><tr><td>278</td><td>MCIERR_DRIVER</td><td>驱动器</td></tr><tr><td>279</td><td>MCIERR_CANNOT_USE_ALL</td><td>不能全部使用</td></tr><tr><td>280</td><td>MCIERR_MULTIPLE</td><td>多个</td></tr><tr><td>281</td><td>MCIERR_EXTENSION_NOT_FOUND</td><td>未找到扩展</td></tr><tr><td>282</td><td>MCIERR_OUTOFRANGE</td><td>超出范围</td></tr><tr><td>284</td><td>MCIERR_FLAGS_NOT_COMPATIBLE</td><td>标志不兼容</td></tr><tr><td>286</td><td>MCIERR_FILE_NOT_SAVED</td><td>文件未保存</td></tr><tr><td>287</td><td>MCIERR_DEVICE_TYPE_REQUIRED</td><td>需要设备类型</td></tr><tr><td>288</td><td>MCIERR_DEVICE_LOCKED</td><td>设备已锁定</td></tr><tr><td>289</td><td>MCIERR_DUPLICATE_ALIAS</td><td>重复别名</td></tr><tr><td>290</td><td>MCIERR_BAD_CONSTANT</td><td>坏常量</td></tr><tr><td>291</td><td>MCIERR_MUST_USE_SHAREABLE</td><td>必须使用可共享</td></tr><tr><td>292</td><td>MCIERR_MISSING_DEVICE_NAME</td><td>缺少设备名称</td></tr><tr><td>293</td><td>MCIERR_BAD_TIME_FORMAT</td><td>错误的时间格式</td></tr><tr><td>294</td><td>MCIERR_NO_CLOSING_QUOTE</td><td>没有关闭中的引用</td></tr><tr><td>295</td><td>MCIERR_DUPLICATE_FLAGS</td><td>重复标志</td></tr><tr><td>296</td><td>MCIERR_INVALID_FILE</td><td>无效文件</td></tr><tr><td>297</td><td>MCIERR_NULL_PARAMETER_BLOCK</td><td>空参数块</td></tr><tr><td>298</td><td>MCIERR_UNNAMED_RESOURCE</td><td>未命名的资源</td></tr><tr><td>299</td><td>MCIERR_NEW_REQUIRES_ALIAS</td><td>新需要别名</td></tr><tr><td>300</td><td>MCIERR_NOTIFY_ON_AUTO_OPEN</td><td>自动打开时通知</td></tr><tr><td>301</td><td>MCIERR_NO_ELEMENT_ALLOWED</td><td>不允许任何元素</td></tr><tr><td>302</td><td>MCIERR_NONAPPLICABLE_FUNCTION</td><td>不可应用功能</td></tr><tr><td>303</td><td>MCIERR_ILLEGAL_FOR_AUTO_OPEN</td><td>非法自动打开</td></tr><tr><td>304</td><td>MCIERR_FILENAME_REQUIRED</td><td>需要文件名</td></tr><tr><td>305</td><td>MCIERR_EXTRA_CHARACTERS</td><td>额外字符 (可能是指多出了一些不需要的字符)</td></tr><tr><td>306</td><td>MCIERR_DEVICE_NOT_INSTALLED</td><td>未安装设备</td></tr><tr><td>307</td><td>MCIERR_GET_CD</td><td>获取 CD</td></tr><tr><td>308</td><td>MCIERR_SET_CD</td><td>设置 CD</td></tr><tr><td>309</td><td>MCIERR_SET_DRIVE</td><td>设置驱动器</td></tr><tr><td>310</td><td>MCIERR_DEVICE_LENGTH</td><td>设备长度</td></tr><tr><td>311</td><td>MCIERR_DEVICE_ORD_LENGTH</td><td>设备 ORD 长度</td></tr><tr><td>312</td><td>MCIERR_NO_INTEGER</td><td>无整数</td></tr><tr><td>320</td><td>MCIERR_WAVE_OUTPUTSINUSE</td><td>波输出</td></tr><tr><td>321</td><td>MCIERR_WAVE_SETOUTPUTINUSE</td><td>波设置输出</td></tr><tr><td>322</td><td>MCIERR_WAVE_INPUTSINUSE</td><td>波输入使用</td></tr><tr><td>323</td><td>MCIERR_WAVE_SETINPUTINUSE</td><td>波设置</td></tr><tr><td>324</td><td>MCIERR_WAVE_OUTPUTUNSPECIFIED</td><td>波输出未指定</td></tr><tr><td>325</td><td>MCIERR_WAVE_INPUTUNSPECIFIED</td><td>波输入未指定</td></tr><tr><td>326</td><td>MCIERR_WAVE_OUTPUTSUNSUITABLE</td><td>波输出可居住</td></tr><tr><td>327</td><td>MCIERR_WAVE_SETOUTPUTUNSUITABLE</td><td>波设置通普通西装</td></tr><tr><td>328</td><td>MCIERR_WAVE_INPUTSUNSUITABLE</td><td>波输入可居住</td></tr><tr><td>329</td><td>MCIERR_WAVE_SETINPUTUNSUITABLE</td><td>波设置通图适合</td></tr><tr><td>336</td><td>MCIERR_SEQ_DIV_INCOMPATIBLE</td><td>Seq Div 不兼容</td></tr><tr><td>337</td><td>MCIERR_SEQ_PORT_INUSE</td><td>SEQ 端口 INUSE</td></tr><tr><td>338</td><td>MCIERR_SEQ_PORT_NONEXISTENT</td><td>Seq 端口不存在</td></tr><tr><td>339</td><td>MCIERR_SEQ_PORT_MAPNODEVICE</td><td>Seq 端口地图无设备</td></tr><tr><td>340</td><td>MCIERR_SEQ_PORT_MISCERROR</td><td>SEQ 杂项错误</td></tr><tr><td>341</td><td>MCIERR_SEQ_TIMER</td><td>SEQ 定时器</td></tr><tr><td>342</td><td>MCIERR_SEQ_PORTUNSPECIFIED</td><td>SEQ 端口未指定</td></tr><tr><td>343</td><td>MCIERR_SEQ_NOMIDIPRESENT</td><td>SEQ 没有MIDI在场</td></tr><tr><td>346</td><td>MCIERR_NO_WINDOW</td><td>无窗口</td></tr><tr><td>347</td><td>MCIERR_CREATEWINDOW</td><td>创建窗口</td></tr><tr><td>348</td><td>MCIERR_FILE_READ</td><td>文件读取</td></tr><tr><td>349</td><td>MCIERR_FILE_WRITE</td><td>文件写入</td></tr><tr><td>350</td><td>MCIERR_NO_IDENTITY</td><td>无标识</td></tr></tbody></table></li></ul><h2 id=附加内容>附加内容:</h2><ul><li><p>下面是我的一些发现</p><blockquote><ol><li>WinForm 程序使用 MCI 是可以打开 MP3 文件的, 但是如果是控制台程序, 就会出现错误, 错误码266, &ldquo;MCIERR_CANNOT_LOAD_DRIVER&rdquo;</li><li>MCI 的某些指令不能正常使用, 但其实并不是很影响, 例如, &ldquo;set <em>device</em> audio <em>left/right</em> <em>off/off</em>&rdquo;, 无法正常使用.</li><li>音量控制我目前还是没弄成&mldr; 不过可以确认的是, 进度获取, 调整, 长度获取是没问题的, 有这些最基本的, 就差不多公用了呢</li></ol></blockquote></li></ul><p><img src=https://img-blog.csdnimg.cn/20210209110959116.png alt="手动翻译, 淦"></p></div><footer class=post-footer><div class=post-tags><a href=/tags/win32 rel=tag title=Win32>#Win32#</a>
<a href=/tags/.net rel=tag title=.NET>#.NET#</a>
<a href=/tags/c rel=tag title=C#>#C##</a>
<a href=/tags/%e5%8f%82%e8%80%83 rel=tag title=参考>#参考#</a>
<a href=/tags/%e7%bb%8f%e9%aa%8c rel=tag title=经验>#经验#</a></div><div class=addthis_inline_share_toolbox></div><div class=post-nav><div class=article-copyright><div class=article-copyright-info><p><span>标题：</span>[Win32] MCI 详解与封装类, MCI 播放音乐, 获取播放状态, 获取音频长度, 进度调整</p><p><span>链接：</span>https://slimenull.top/post/win32-mci/</p><p><span>作者：</span>史莱姆诺尔</p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div><button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");qr.style.display==="none"?qr.style.display="block":qr.style.display="none"'>
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/img/ali-pay.png alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://slimenull.top/post/csharp-playmusic/ rel=next title="[C#] 音乐播放 3 种方式 Demo 与 MCI 音乐播放器封装类"><i class="fa fa-chevron-left"></i> [C#] 音乐播放 3 种方式 Demo 与 MCI 音乐播放器封装类</a></div><div class="post-nav-prev post-nav-item"><a href=https://slimenull.top/post/win32-getshortpathname/ rel=prev title="[Win32] GetShortPathName详解, 长路径转换为短路径">[Win32] GetShortPathName详解, 长路径转换为短路径
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/img/avatar.jpg alt=史莱姆诺尔><p class=site-author-name itemprop=name>史莱姆诺尔</p><p class="site-description motion-element" itemprop=description>我很可爱, 请给我糖 o(*////▽////*)q</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>83</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>0</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>43</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/slimenull/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://space.bilibili.com/441842015 target=_blank title=Bilibili><i class="fa fa-fw fa-tv"></i>
Bilibili</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class=links-of-blogroll-title><i class="fa fa-fw fa-globe"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://vertillusion.xyz/ title=Vertillusion target=_blank>Vertillusion</a></li></ul></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/.net>.Net
<sup>54</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/c>C#
<sup>45</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%AC%94%E8%AE%B0>笔记
<sup>36</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E8%BD%AE%E5%AD%90>轮子
<sup>16</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E5%8F%82%E8%80%83>参考
<sup>12</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%AE%97%E6%B3%95>算法
<sup>8</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E7%BB%8F%E9%AA%8C>经验
<sup>8</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/wpf>Wpf
<sup>7</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/linux>Linux
<sup>6</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%95%99%E7%A8%8B>教程
<sup>6</sup></a></li></ul></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2022</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>诺尔的小窝</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.95.0</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv><i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span></span>
<span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div><div class=license-info><span class=storage-info>Storage by
<a href=https://www.ucloud.cn/ style=font-weight:700 target=_blank>UCloud云存储</a></span>
<span class=separator-line>/</span>
<span class=license-num><a href=http://beian.miit.gov.cn target=_blank>粤ICP备18047355号</a></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//unpkg.com/jquery@2.1.4/dist/jquery.min.js></script>
<script type=text/javascript src=https://slimenull.topjs/search.js></script>
<script type=text/javascript src=https://slimenull.topjs/affix.js></script>
<script type=text/javascript src=https://slimenull.topjs/scrollspy.js></script>
<script type=text/javascript>function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){var t=$("#content").height(),e=$(window).height(),n=t>e?t-e:$(document).height()-e;return n}function getScrollbarWidth(){var e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){var t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);var s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){var t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){var e=$(".header-inner").height(),t=parseInt($(".main").css("padding-bottom"),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}}),$(document).on("affixed.bs.affix",function(){updateTOCHeight(document.body.clientHeight-100)})}function initTOCDimension(){$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);var e,t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){var t=$(".header-inner").height()+10,n,s,e,o;$("#sidebar").css({'margin-top':t}).show(),n=parseInt($("#sidebar").css("margin-top")),s=parseInt($(".sidebar-inner").css("height")),e=n+s,o=$(".content-wrap").height(),o<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){var e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initScrollSpy(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=//unpkg.com/imageviewer@1.1.0/dist/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script type=text/javascript>const locale={placeholder:"欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^"};$(function(){detectIE()>0?$.getScript(document.location.protocol+"//unpkg.com/@waline/client@1.6.0/dist/Waline.min.js",function(){new Waline({el:"#wcomments",visitor:!0,emoji:[],wordLimit:"200",uploadImage:!1,locale,requiredMeta:["nick","mail"],serverURL:"https://hugo-blog-api-slimenull.vercel.app/",lang:"zh-cn"})}):$("#wcomments").html("抱歉，Waline插件不支持IE，建议使用Chrome浏览器。")})</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=623eced69d98b93c"></script>
<script>(function(){var e=document.createElement("script"),t,n=window.location.protocol.split(":")[0];n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>